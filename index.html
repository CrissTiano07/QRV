<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Painel Operacional ‚Äî Tr√¢nsito Fortaleza</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>
<style>
:root{
  --fundo:#e9eef5;
  --sombra:#c5cad3;
  --luz:#ffffff;
  --laranja:#f97316;
  --vermelho:#dc2626;
  --texto:#0f172a;
  --verde:#16a34a;
  --azul:#2563eb;
  --amarelo:#facc15;
  --cinza:#475569;
}

/* BASE */
html,body{
  margin:0;height:100%;width:100%;
  background:var(--fundo);
  font-family:'Inter',system-ui,sans-serif;
  color:var(--texto);
  overflow:hidden;
  -webkit-tap-highlight-color:transparent;
  transition:background .3s ease,color .3s ease;
}
.view{
  position:absolute;top:0;left:0;width:100%;height:100%;
  transition:transform .5s cubic-bezier(.25,.8,.25,1);
  background:var(--fundo);
}
.hidden-right{transform:translateX(100%);}
.hidden-left{transform:translateX(-100%);}
.active{transform:translateX(0);}

/* CABE√áALHO */
header{
  display:flex;justify-content:space-between;align-items:center;
  padding:10px 16px;
}
h1{
  font-size:clamp(18px,4vw,22px);
  color:var(--laranja);
  letter-spacing:0.4px;
  font-weight:700;
  text-shadow:1px 1px 2px var(--luz);
  margin:0;
}
.theme-toggle{
  background:none;border:none;color:var(--texto);
  width:32px;height:32px;display:flex;align-items:center;justify-content:center;
}
.theme-toggle svg{width:22px;height:22px;}


.painel{
  display:grid;
  grid-template-columns:1fr 1fr;
  grid-template-rows:repeat(3,1fr);
  gap:14px;
  width:70vw; 
  max-width:380px;
  height:55vh; /* Reserva espa√ßo para header + barra inferior */
  margin:2vh auto;
}
.btn{
  border:none;border-radius:20px;
  background:var(--fundo);
  box-shadow:8px 8px 16px var(--sombra), -8px -8px 16px var(--luz);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  font-size:15px;font-weight:700;color:var(--texto);
  transition:all .0,5s ease-in-out;
}
.btn:active{
  box-shadow:inset 8px 8px 16px var(--sombra),
              inset -8px -8px 16px var(--luz);
  transform:scale(.97);
}
.btn svg{width:28px;height:28px;margin-bottom:6px;}
.qrv svg{stroke:var(--laranja);}
.rendicao svg{stroke:var(--cinza);}
.foto svg{stroke:var(--azul);}
.cones svg{stroke:var(--amarelo);}
.apoio svg{stroke:var(--vermelho);}
.chat svg{stroke:var(--verde);}

/* BARRA INFERIOR */
.bottom-bar{
  position:absolute;bottom:0;left:0;width:100%;
  display:flex;justify-content:space-evenly;align-items:center;
  padding:16px 0;background:var(--fundo);
  box-shadow:0 -6px 16px rgba(0,0,0,0.05);
}
.bottom-btn{
  width:40%;max-width:150px;height:58px;
  border-radius:40px;font-weight:700;font-size:15px;
  display:flex;align-items:center;justify-content:center;gap:6px;
  transition:all .0.3s ease-in-out;
  box-shadow:8px 8px 16px var(--sombra), -8px -8px 16px var(--luz);
  background:var(--fundo);
}
.bottom-btn svg{width:20px;height:20px;}
.bottom-btn:active{
  box-shadow:inset 8px 8px 16px var(--sombra), inset -8px -8px 16px var(--luz);
  transform:scale(.96);
}
.btn-emergencia{color:var(--vermelho);}
.btn-central{color:var(--laranja);}

/* FORMUL√ÅRIO QRV */
/* SUBSTITUA a se√ß√£o de FORMUL√ÅRIO por: */

.card{
  background:var(--fundo);
  border-radius:20px;
  box-shadow:8px 8px 16px var(--sombra), -8px -8px 16px var(--luz);
  padding:24px;
  width:86%;
  max-width:420px;
  margin:auto;
}

label{
  display:block;
  font-size:13px;
  font-weight:700;
  letter-spacing:0.5px;
  margin-top:16px;
  margin-bottom:8px;
  color:var(--laranja); /* ‚Üê destaque laranja */
  text-transform:uppercase;
}

input{
  width:100%;
  border:none;
  outline:none;
  background:var(--fundo);
  box-shadow:inset 5px 5px 10px var(--sombra),
             inset -5px -5px 10px var(--luz);
  border-radius:14px;
  padding:16px 18px;
  font-size:17px;
  font-weight:600;
  color:var(--texto);
  text-transform:uppercase;
  transition:box-shadow .2s ease;
}

input:focus{
  box-shadow:inset 3px 3px 8px var(--sombra), 
             inset -3px -3px 8px var(--luz),
             0 0 0 3px rgba(249,115,22,0.15); /* ‚Üê anel laranja ao focar */
}

input::placeholder{
  color:var(--cinza);
  opacity:0.6;
  font-weight:500;
}

.send-area{
  display:flex;
  gap:10px;
  justify-content:center;
  margin-top:24px;
}

.primary-btn{
  background:linear-gradient(145deg, #ff8a47, #f97316);
  color:#fff;
  border:none;
  border-radius:14px;
  padding:14px 28px;
  font-size:16px;
  font-weight:700;
  box-shadow:6px 6px 12px #c5cad3, 
             -6px -6px 12px #fff,
             inset 0 1px 2px rgba(255,255,255,0.3);
  transition:all .12s ease-in-out;
}
.primary-btn:active{
  box-shadow:inset 6px 6px 12px #c5cad3, 
             inset -6px -6px 12px #fff;
  transform:scale(.98);
}

/* Modo escuro - ajustes */
.dark textarea{
  box-shadow:inset 5px 5px 10px var(--sombra),
             inset -5px -5px 10px var(--luz);
}


.dark{
  --fundo:#0e1624;
  --sombra:#060910;
  --luz:#1b2434;
  --texto:#e6eef8;
}
.dark .btn,.dark .bottom-btn,.dark .card{
  box-shadow:8px 8px 16px var(--sombra), -8px -8px 16px var(--luz);
}
.dark h1{color:#f97316;text-shadow:none;}
.dark .btn-emergencia{color:#ef4444;}
.dark .btn-central{color:#f97316;}
.dark .theme-toggle{color:#e6eef8;}
</style>
</head>
<body>

<!-- MENU PRINCIPAL -->
<div id="menuView" class="view active">
  <header>
    <h1>Painel Operacional</h1>
    <button class="theme-toggle" id="themeToggle" title="Alternar tema"><i data-lucide="moon"></i></button>
  </header>

  <div class="painel">
    <button class="btn qrv" onclick="abrir('qrvView')"><i data-lucide="radio"></i>QRV</button>
    <button class="btn rendicao" onclick="abrir('rendView')"><i data-lucide="refresh-ccw"></i>Rendi√ß√£o</button>
    <button class="btn foto" onclick="abrir('fotoView')"><i data-lucide="camera"></i>Foto</button>
    <button class="btn cones" onclick="abrir('conesView')"><i data-lucide="traffic-cone"></i>Cones</button>
    <button class="btn apoio" onclick="abrir('apoioView')"><i data-lucide="life-buoy"></i>Apoio</button>
    <button class="btn chat" onclick="abrir('chatView')"><i data-lucide="messages-square"></i>Chat</button>
  </div>

  <div class="bottom-bar">
    <button class="bottom-btn btn-emergencia" id="emergenciaBtn"><i data-lucide="alert-triangle"></i>Emerg√™ncia</button>
    <button class="bottom-btn btn-central" onclick="ligarCentral()"><i data-lucide="phone"></i>Central</button>
  </div>
</div>

<!-- VIEW QRV -->
<div id="qrvView" class="view hidden-right">
  <header>
    <button onclick="voltar('qrvView')" class="theme-toggle"><i data-lucide="arrow-left"></i></button>
    <h1>QRV Operacional</h1>
    <div style="width:32px;"></div>
  </header>

  <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:85%;">
    <form id="qrvForm" class="card" autocomplete="off">
      <label for="vt">Viatura (VT)</label>
      <input id="vt" type="text" inputmode="numeric" placeholder="Ex: 222" required>

      <label for="equipe">Equipe</label>
      <input id="equipe" type="text" placeholder="Condutor, Tripulante, Tripulante" required>

      <label for="qru">QRU</label>
      <input list="qruList" id="qru" placeholder="Selecione ou digite..." required>
      <datalist id="qruList">
        <option value="CONTROLE DE TR√ÅFEGO">
        <option value="APOIO OPERACIONAL">
        <option value="ACIDENTE">
        <option value="RETIRADA DE OBST√ÅCULO">
        <option value="DESLOCAMENTO">
        <option value="ABORDAGEM">
        <option value="PATRULHAMENTO">
        <option value="OUTROS">
      </datalist>

      <label for="qth">QTH</label>
      <input id="qth" type="text" placeholder="Ex: RUA 01 X RUA 02" required>

      <div class="send-area">
        <button type="button" class="primary-btn" onclick="enviarQRV()">Enviar</button>
      </div>
    </form>
  </div>
</div>

<!-- OUTRAS VIEWS PLACEHOLDER -->
<div id="rendView" class="view hidden-right"><header><button onclick="voltar('rendView')" class="theme-toggle"><i data-lucide="arrow-left"></i></button><h1>Rendi√ß√£o</h1><div style="width:32px;"></div></header><div style="display:flex;justify-content:center;align-items:center;height:70%;"><p>Em desenvolvimento.</p></div></div>
<div id="fotoView" class="view hidden-right">
  <header>
    <button onclick="voltar('fotoView')" class="theme-toggle"><i data-lucide="arrow-left"></i></button>
    <h1>Registro Fotogr√°fico</h1>
    <div style="width:32px;"></div>
  </header>

  <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:85%;overflow-y:auto;padding:20px 0;">
    <div class="card">
      <label for="fotoVt">Viatura (VT)</label>
      <input id="fotoVt" type="text" readonly style="opacity:0.7;">

      <label for="fotoEquipe">Equipe</label>
      <input id="fotoEquipe" type="text" readonly style="opacity:0.7;">

      <label for="fotoQru">QRU</label>
      <input id="fotoQru" type="text" readonly style="opacity:0.7;">

      <label for="fotoQth">QTH</label>
      <input id="fotoQth" type="text" readonly style="opacity:0.7;">

      <div style="margin-top:24px;text-align:center;">
        <input type="file" id="inputFoto" accept="image/*" capture="environment" style="display:none;">
        <button type="button" class="primary-btn" onclick="tirarFoto()" style="width:100%;">
          Tirar Foto
        </button>
      </div>

      <div id="previewContainer" style="margin-top:20px;display:none;">
        <img id="previewFoto" style="width:100%;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.15);">
        <div style="display:flex;gap:10px;margin-top:16px;">
          <button type="button" class="primary-btn" onclick="enviarFoto()" style="flex:1;">Enviar</button>
          <button type="button" onclick="resetarFoto()" style="flex:1;background:var(--cinza);color:#fff;border:none;border-radius:14px;padding:14px;font-weight:700;box-shadow:6px 6px 12px var(--sombra),-6px -6px 12px var(--luz);">Nova Foto</button>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="conesView" class="view hidden-right"><header><button onclick="voltar('conesView')" class="theme-toggle"><i data-lucide="arrow-left"></i></button><h1>Cones</h1><div style="width:32px;"></div></header><div style="display:flex;justify-content:center;align-items:center;height:70%;"><p>Em desenvolvimento.</p></div></div>
<div id="apoioView" class="view hidden-right">
  <header>
    <button onclick="voltar('apoioView')" class="theme-toggle"><i data-lucide="arrow-left"></i></button>
    <h1>Apoio Operacional</h1>
    <div style="width:32px;"></div>
  </header>

  <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:85%;">
    <form id="apoioForm" class="card" autocomplete="off">
      <label for="apoioVt">Viatura (VT)</label>
      <input id="apoioVt" type="text" readonly style="opacity:0.7;">

      <label for="apoioCondutor">Condutor</label>
      <input id="apoioCondutor" type="text" readonly style="opacity:0.7;">

      <label for="apoioQth">QTH</label>
      <input id="apoioQth" type="text" readonly style="opacity:0.7;">

      <label for="apoioObs">Observa√ß√£o (Opcional)</label>
      <textarea id="apoioObs" placeholder="COMPLEMENTO..." style="width:100%;border:none;outline:none;background:var(--fundo);box-shadow:inset 5px 5px 10px var(--sombra),inset -5px -5px 10px var(--luz);border-radius:14px;padding:16px 18px;font-size:17px;font-weight:600;color:var(--texto);text-transform:uppercase;margin-top:6px;min-height:80px;resize:vertical;"></textarea>

      <div class="send-area">
        <button type="button" class="primary-btn" onclick="solicitarApoio()">Solicitar Apoio</button>
      </div>
    </form>
  </div>
</div>
<div id="chatView" class="view hidden-right"><header><button onclick="voltar('chatView')" class="theme-toggle"><i data-lucide="arrow-left"></i></button><h1>Chat</h1><div style="width:32px;"></div></header><div style="display:flex;justify-content:center;align-items:center;height:70%;"><p>Em desenvolvimento.</p></div></div>

<script>
lucide.createIcons();

/* Navega√ß√£o */
function abrir(id){
  const menu=document.getElementById('menuView');
  const tela=document.getElementById(id);
  
  // Se abrindo FOTO ou APOIO, carrega dados do QRV
  if(id==='fotoView' || id==='apoioView'){
    const vtVal=vt.value.trim();
    const eqVal=equipe.value.trim();
    const qruVal=qru.value.trim();
    const qthVal=qth.value.trim();
    
    if(!vtVal||!eqVal||!qruVal||!qthVal){
      alert('Preencha o QRV primeiro');
      return;
    }
    
    // Extrai apenas o condutor (primeiro nome da equipe)
    const condutor=eqVal.split(',')[0].trim();
    
    if(id==='fotoView'){
      document.getElementById('fotoVt').value=vtVal;
      document.getElementById('fotoEquipe').value=eqVal;
      document.getElementById('fotoQru').value=qruVal;
      document.getElementById('fotoQth').value=qthVal;
    }else if(id==='apoioView'){
      document.getElementById('apoioVt').value=vtVal;
      document.getElementById('apoioCondutor').value=condutor;
      document.getElementById('apoioQth').value=qthVal;
      document.getElementById('apoioObs').value='';
    }
  }
  
  menu.classList.remove('active');menu.classList.add('hidden-left');
  tela.classList.remove('hidden-right');tela.classList.add('active');
  try{navigator.vibrate?.(40);}catch(e){}
}

function voltar(id){
  const menu=document.getElementById('menuView');
  const tela=document.getElementById(id);
  tela.classList.remove('active');tela.classList.add('hidden-right');
  menu.classList.remove('hidden-left');menu.classList.add('active');
  try{navigator.vibrate?.(30);}catch(e){}
}

/* Tema */
const toggle=document.getElementById('themeToggle');
let dark=localStorage.getItem('theme')==='dark';
if(dark) document.body.classList.add('dark');
toggle.addEventListener('click',()=>{
  document.body.classList.toggle('dark');
  dark=document.body.classList.contains('dark');
  localStorage.setItem('theme',dark?'dark':'light');
  toggle.innerHTML=dark?'<i data-lucide="sun"></i>':'<i data-lucide="moon"></i>';
  lucide.createIcons();
});

/* Emerg√™ncia */
const emergenciaBtn=document.getElementById('emergenciaBtn');
let longPress;
emergenciaBtn.addEventListener('touchstart',()=>{
  emergenciaBtn.style.transform='scale(0.95)';
  longPress=setTimeout(()=>window.location.href='tel:190',1200);
});
emergenciaBtn.addEventListener('touchend',()=>{
  clearTimeout(longPress);
  emergenciaBtn.style.transform='scale(1)';
});
function ligarCentral(){window.location.href='tel:+5585XXXXXXXX';}

/* Formul√°rio QRV */
const vt=document.getElementById('vt');
const equipe=document.getElementById('equipe');
const qru=document.getElementById('qru');
const qth=document.getElementById('qth');
[vt,qth].forEach(f=>f.addEventListener('focus',()=>f.select()));
[equipe,qru,qth,vt].forEach(f=>f.addEventListener('input',()=>f.value=f.value.toUpperCase()));
function enviarQRV(){
  const vtVal=vt.value.trim(), eq=equipe.value.trim(), qruVal=qru.value.trim(), qthVal=qth.value.trim();
  if(!vtVal||!eq||!qruVal||!qthVal){alert('Preencha todos os campos');return;}
  const texto=`VT ${vtVal}\n${eq} (CONDUTOR)\nQRU: ${qruVal}\nQTH: ${qthVal}`;
  const encoded=encodeURIComponent(texto);
  window.location.href=`whatsapp://send?text=${encoded}`;
}

/* === FOTO === */
let fotoBlob=null;

function tirarFoto(){
  document.getElementById('inputFoto').click();
}

document.getElementById('inputFoto').addEventListener('change',(e)=>{
  const file=e.target.files[0];
  if(!file) return;
  
  fotoBlob=file;
  const reader=new FileReader();
  reader.onload=(ev)=>{
    document.getElementById('previewFoto').src=ev.target.result;
    document.getElementById('previewContainer').style.display='block';
  };
  reader.readAsDataURL(file);
});

function resetarFoto(){
  fotoBlob=null;
  document.getElementById('inputFoto').value='';
  document.getElementById('previewFoto').src='';
  document.getElementById('previewContainer').style.display='none';
}

function enviarFoto(){
  if(!fotoBlob){alert('Tire uma foto primeiro');return;}
  
  const vtVal=document.getElementById('fotoVt').value;
  const eqVal=document.getElementById('fotoEquipe').value;
  const qruVal=document.getElementById('fotoQru').value;
  const qthVal=document.getElementById('fotoQth').value;
  
  const msg=`üì∏ REGISTRO FOTOGR√ÅFICO\n\nVT ${vtVal}\n${eqVal}\nQRU: ${qruVal}\nQTH: ${qthVal}`;
  
  // Tenta usar API nativa de compartilhamento (funciona em Android/iOS modernos)
  if(navigator.share){
    const fotoFile=new File([fotoBlob],'registro.jpg',{type:'image/jpeg'});
    navigator.share({
      title:'Registro Operacional',
      text:msg,
      files:[fotoFile]
    }).then(()=>{
      resetarFoto();
      voltar('fotoView');
    }).catch(err=>{
      // Fallback se usu√°rio cancelar
      console.log('Compartilhamento cancelado');
    });
  }else{
    // Navegadores que n√£o suportam navigator.share
    alert('Foto capturada!\n\nPara enviar:\n1. Abra o WhatsApp\n2. Cole a mensagem\n3. Anexe a foto manualmente');
    navigator.clipboard.writeText(msg);
    resetarFoto();
  }
}

/* === APOIO === */
function solicitarApoio(){
  const vtVal=document.getElementById('apoioVt').value;
  const condutor=document.getElementById('apoioCondutor').value;
  const qthVal=document.getElementById('apoioQth').value;
  const obs=document.getElementById('apoioObs').value.trim();
  
  let msg=`Viatura equipe: ${condutor} VT: ${vtVal} solicita apoio em QTH: ${qthVal}`;
  
  if(obs){
    msg+=`\nObserva√ß√£o: ${obs}`;
  }
  
  const encoded=encodeURIComponent(msg);
  window.location.href=`whatsapp://send?text=${encoded}`;
  
  // Limpa observa√ß√£o ap√≥s enviar
  document.getElementById('apoioObs').value='';
}

</script>
</body>
</html>